This is the code of [Longyin Wen's](http://www.cbsr.ia.ac.cn/users/lywen/) hyper graph multi-target tracking algorithm: **`Longyin Wen, Wenbo Li, Junjie Yan, Zhen Lei, Dong Yi, Stan Z. Li, "Multiple Target Tracking Based on Undirected Hierarchical Relation Hypergraph, published in IEEE Conference on Computer Vision and Pattern Recognition 2014.`** re-organized by CMake.

## How to build
### Prerequiste
OpenCV and CMake are needed to build the code. We are using OpenCV2.4.13 for this project, please follow the [instructions](http://docs.opencv.org/2.4/doc/tutorials/introduction/linux_install/linux_install.html) to build OpenCV source code.
### Linux
* Creat a build directory outside the source code folder, like the example folder: `hgtrack_build_gcc`. 
* Change the OpenCV path in `__cmake_hgtrack_gcc.sh`. Then run `__cmake_hgtrack_gcc.sh` to generate make file. 
* Then run `make all` in terminal to build the whole project. The executable program will be located at `bin/` folder.
### Windows
* Creat a build directory outside the source code folder, like the example folder: `hgtrack_build_gcc`. 
* Change the OpenCV path and corresponding Visual Studio versions in `__cmake_hgtrack_vc12x64.bat`. Run `__cmake_hgtrack_vc12x64.bat` to generate visual studio project. 
* Then open the solution with Visual Studio to build the whole project.

## How to run
There are some configuration files to be provided for running the code.
### Configuration file
Running the executatble program `bin/mt_tracker_example` needs a config file named `GraphMultiCarTracker_Config.txt`. Change items in the config file according to your need. Be careful, the break line should be in linux `LF` format if you run it on Linux platform. 
Below is the example of the `GraphMultiCarTracker_Config.txt` file.
```
###################################################################################
## Main Parameters for Hierarchical Dense Structures Revealing Based Tracker
###################################################################################
#INPUT_DATA_FILE_NAME
MVI_39031/

#INPUT_VIDEO_FILE_PATH
MVI_39031/Example_Path.txt

#INPUT_DETECTION_FILE_PATH
Detection/mvi_39031.txt

#OUTPUT_TRAJECTORY_FILE_PATH
Results/Image/

#OUTPUT_TRAJECTORY_FILE_PATH
Results/Trajectory/

#OUTPUT_SPEED_FILE_PATH
Results/Speed/

#IMAGE_WIDTH
960

#IMAGE_HEIGHT
540

#TOTAL_FRAME_NUMBER
1470

#CAR_MINIMAL_WIDTH
5

#CAR_MINIMAL_HEIGHT
5

#SEGMENT_SIZE_EACH_LAYER
6,3

#TRACK_KARY_LAYER
3
```
### Input file list
In the config file, the item `INPUT_VIDEO_FILE_PATH` specifies the input image file list. In this file, each line denotes the path of one video frame.

### Detection file
`INPUT_DETECTION_FILE_PATH` requires the detection result file for each video frame.


## Format of input
* The input detection file contains the bounding box information for each frame. Each line of the file has 7 entries: `Frame, Number, Left, Top, Width, Height, Score` in order.
* The *INPUT_VIDEO_FILE_PATH* should contain the path(relative path or absolute path) of input frames.

## Format of output
The results of video sequence should have three folders and five .txt files. 
```
|-----Image
|-----Speed
|     |-----SequenceName_Speed.txt
|-----Trajectory
|     |-----SequenceName_H.txt
|     |-----SequenceName__LX.txt
|     |-----SequenceName__LY.txt
|     |-----SequenceName_W.txt
```
The Speed file records the running speed of the tracker. We use frame-Per-second (fps) to measure the speed of the tracker. Four files with the position suffix (i.e., LX, LY, W and H) are the position result, which stand for Left, Top, Width, Height information of the bounding box on the object trajectories generated by the tracker.